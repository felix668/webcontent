<style lang="less" scoped>
  .PageMain {
    position: relative;
    background: #1d1523;
    .header {
      position: relative;
      width: 100%;
      .books_length {
        position: absolute; left: 0; top: 7.78rem;
        width: 100%;
        line-height: 0.7rem;
        font-size: 0.64rem;
        font-weight: 600;
        color: #9f436b;
        text-align: center;
        vertical-align: middle;
        span {
          display: inline-block;
          line-height: 0.7rem;
          font-size: 0.48rem;
          vertical-align: top;
        }
      }
      .explaination {
        position: absolute; left: 0; top: 8.7rem;
        width: 100%;
        font-size: 0.24rem;
        color: #886292;
        text-align: center;
        overflow: hidden;
      }
      .to_house {
        position: absolute; left: 2.48rem; top: 9.62rem;
        width: 1.04rem; height: 0.38rem;
        // background: orange;
      }
    }
    .undone {
      position: relative;
      width: 100%;
      overflow: hidden;
      .text {
        display: table;
        margin: auto; margin-bottom: 0.3rem;
        overflow: hidden;
        .text_qq {
          float: left;
          width: 1.13rem;
        }
        .text_farm {
          float: left;
          width: 1rem;
        }
        .text_num {
          float: left;
          font-size: 0.28rem;
          line-height: 0.3rem;
          color: #a1436b;
          font-weight: 600;
        }
        .text_books {
          float: left;
          width: 1.23rem;
        }
      }
    }
    .frame {
      position: relative;
      width: 7.18rem; height: 3.29rem;
      margin: auto; margin-bottom: 0.1rem;
      .avatar {
        position: absolute; left: 0.52rem; top: 0.86rem;
        width: 1.2rem; height: 1.2rem;
        border: 0.07rem solid #42324e;
        border-radius: 1000px;
        overflow: hidden;
        img {
          width: 100%; height: 100%;
        }
      }
      .after {
        position: relative;
        width: 100%; height: 100%;
        .p0 {
          position: absolute; left: 2.3rem; top: 0.5rem;
          font-size: 0.24rem; color: #f0dabf;
        }
        .p1 {
          position: absolute; left: 2.3rem; top: 1.05rem;
          font-size: 0.24rem; color: #8e826e;
        }
        .p_to_login {
          position: absolute; left: 2.3rem; top: 1.9rem;
          font-size: 0.24rem; color: #f0dabf;
        }
        .p2 {
          position: absolute; left: 2.3rem; top: 1.87rem;
          line-height: 0.26rem;
          font-size: 0.24rem; color: #8e826e;
          vertical-align: middle;
          .icon_clock {
            display: inline-block;
            margin: 0 0.1rem 0 0;
            vertical-align: middle;
            width: 0.22rem;
            height: 0.22rem;
          }
          span {
            display: inline-block;
            vertical-align: middle;
          }
        }
        .p3 {
          position: absolute; left: 2.3rem; top: 2.28rem;
          font-size: 0.24rem; color: #f0dabf;
          line-height: 0.3rem;
          span {
            font-size: 0.28rem;
            font-weight: 600;
          }
        }
        .p4 {
          position: absolute; right: 0.4rem; top: 2.28rem;
          font-size: 0.24rem; color: #8e826e;
        }
      }
      .god {
        position: relative;
        width: 100%; height: 100%;
        .god_avatar {
          position: absolute; left: 0.5rem; top: 0.35rem;
          width: 1.39rem;

        }
        .p0 {
          position: absolute; left: 2.3rem; top: 0.71rem;
          font-size: 0.24rem; color: #e2a956;
        }
        .p2 {
          position: absolute; left: 2.3rem; top: 1.87rem;
          line-height: 0.26rem;
          font-size: 0.24rem; color: #8e826e;
          vertical-align: middle;
          .icon_clock {
            display: inline-block;
            margin: 0 0.1rem 0 0;
            vertical-align: middle;
            width: 0.22rem;
            height: 0.22rem;
          }
          span {
            display: inline-block;
            vertical-align: middle;
          }
        }
        .p3 {
          position: absolute; left: 2.3rem; top: 2.28rem;
          font-size: 0.24rem; color: #f0dabf;
          line-height: 0.3rem;
          span {
            font-size: 0.28rem;
            font-weight: 600;
          }
        }
      }
    }
    .frame_small {
      position: relative;
      width: 7.18rem; height: 2.35rem;
      margin: auto; margin-bottom: 0.1rem;
      .avatar {
        position: absolute; left: 0.52rem; top: 0.5rem;
        width: 1.2rem; height: 1.2rem;
        border: 0.07rem solid #42324e;
        border-radius: 1000px;
        overflow: hidden;
        img {
          width: 100%; height: 100%;
        }
      }
      .after {
        position: relative;
        width: 100%; height: 100%;
        .p0 {
          position: absolute; left: 2.3rem; top: 0.46rem;
          font-size: 0.24rem; color: #f0dabf;
        }
        .p2 {
          position: absolute; left: 2.3rem; top: 1.08rem;
          line-height: 0.26rem;
          font-size: 0.24rem; color: #8e826e;
          vertical-align: middle;
          .icon_clock {
            display: inline-block;
            margin: 0 0.1rem 0 0;
            vertical-align: middle;
            width: 0.22rem;
            height: 0.22rem;
          }
          span {
            display: inline-block;
            vertical-align: middle;
          }
        }
        .p3 {
          position: absolute; left: 2.3rem; top: 1.5rem;
          font-size: 0.24rem; color: #f0dabf;
          line-height: 0.3rem;
          span {
            font-size: 0.28rem;
            font-weight: 600;
          }
        }
      }
    }
    .btn_warp {
      width: 6.7rem;
      margin: auto; margin-top: 0.7rem;
    }
  }
</style>

<template>
  <div class="PageMain" v-show="stage.current===1">
    <mask-house></mask-house>
    <mask-donated></mask-donated>

    <div class="header"
    :style=" 'background-image:url('+img+'/main/bg_0.png);background-size:100% auto;' ">
      <svg-stroke-circle></svg-stroke-circle>
      <canvas-counter></canvas-counter>
      <p class="books_length">
        {{donated.books}}<span>本书</span>
      </p>
      <p class="explaination">
        （1本书≈600000字）
      </p>
      <div class="to_house"
      @click="$store.dispatch({type:'SHOW',what:'mask_house'})">
      </div>
    </div>

    <div class="undone" v-show=" done===false ">
      <div class="text">
        <img class="text_qq" :src=" img+'/main/text_qq.png' "/>
        <img class="text_farm" :src=" img+'/main/text_farm.png' "
        @click="$store.dispatch({type:'SHOW',what:'mask_house'})"/>
        <div class="text_num">
          捐10000+
        </div>
        <img class="text_books" :src=" img+'/main/text_books.png' "/>
      </div>
      <div class="frame"
      v-if=" !meta.share "
      :style=" 'background-image:url('+img+'/main/frame.png);background-size:100% auto;background-repeat:no-repeat;' ">
        <div class="avatar">
          <img :src=" user.avatar "/>
        </div>
        <div class="after">
          <p class="p0" v-show=" !user.loggedIn ">QQ阅读邀你一起捐书</p>
          <p class="p0" v-show=" user.loggedIn ">{{name_sliced}}，QQ阅读邀你一起捐书</p>
          <p class="p1">每阅读30分钟，QQ阅读捐出1000字</p>

          <p class="p_to_login" v-show=" !user.loggedIn "
          @click="$store.dispatch({type:'TO_LOGIN'})">登录查看阅读时长 ></p>
          <p class="p2" v-if=" user.loggedIn ">
            <img class="icon_clock" :src=" img+'/main/icon_clock.png' "/>
            <span>阅读时长</span>
          </p>
          <p class="p3" v-if=" user.loggedIn ">
            <span>{{Math.floor(user.time_span)}}</span>分钟≈<span>{{Math.floor( Math.floor(user.time_span)*(1000/30) )}}</span>字
          </p>
          <p class="p4" v-if=" user.loggedIn "
          @click="$store.dispatch({type:'SHOW',what:'mask_donated'})">
            已捐时长 >
          </p>
        </div>
      </div>

      <div class="frame_small"
      v-if=" meta.share "
      :style=" 'background-image:url('+img+'/main/frame_small.png);background-size:100% auto;background-repeat:no-repeat;' ">
        <div class="avatar">
          <img :src=" user.avatar "/>
        </div>
        <div class="after">
          <p class="p0">我在QQ阅读为农家书屋捐书</p>
  <!--         <p class="p1">每阅读30分钟，QQ阅读捐出1000字</p>

          <p class="p_to_login" v-show=" !user.loggedIn "
          @click="$store.dispatch({type:'TO_LOGIN'})">登录查看阅读时长 ></p> -->
          <p class="p2">
            <img class="icon_clock" :src=" img+'/main/icon_clock.png' "/>
            <span>已捐时长</span>
          </p>
          <p class="p3">
            <span>{{user.donated}}</span>分钟≈<span>{{Math.floor( user.donated*(1000/30) )}}</span>字
          </p>
        </div>
      </div>

      <div class="frame"
      :style=" 'background-image:url('+img+'/main/frame.png);background-size:100% auto;background-repeat:no-repeat;' ">
        <div class="god">
          <img class="god_avatar" :src=" img+'/main/gods/'+god.id+'.png' "/>
          <p class="p0">{{god.name}}大神陪你阅读，与你一起捐书</p>
          <p class="p2">
            <img class="icon_clock" :src=" img+'/main/icon_clock.png' "/>
            <span>已捐时长</span>
          </p>
          <p class="p3">
            <span>{{god.donated}}</span>分钟≈<span>{{Math.floor( god.donated/30*1000 )}}</span>字
          </p>
        </div>
      </div>

      <img class="btn_warp" :src=" img+'/main/btn_warp.png' "
      @click="$store.dispatch({type:'TO_PAGE_TOTAL'})"/>
      <rules></rules>
    </div>


    <part-done></part-done>
    <fixed-footer></fixed-footer>
  </div>
</template>

<script type="text/javascript">
  export default {
    components: {
      MaskHouse: require('components/_main/MaskHouse.vue'),
      MaskDonated: require('components/_main/MaskDonated.vue'),

      SvgStrokeCircle: require('components/_main/SvgStrokeCircle.vue'),
      CanvasCounter: require('components/_main/CanvasCounter.vue'),
      FixedFooter: require('components/_main/FixedFooter.vue'),
      Rules: require('components/_main/Rules.vue'),

      PartDone: require('components/_main/PartDone.vue')
    },
    computed: {
      name_sliced(){
        return this.$store.getters.name_sliced;
      },
      done(){
        return this.$store.state.done;
      },
      img(){
        return this.$store.state.img;
      },
      stage(){
        return this.$store.state.stage;
      },
      meta(){
        return this.$store.state.meta;
      },
      user(){
        return this.$store.state.user;
      },
      god(){
        return this.$store.state.god;
      },
      donated(){
        return this.$store.state.donated;
      },
      percentage(){
        return (this.donated.minutes/100000000).toFixed(6);
      },
      books(){
        return Math.floor(this.donated.minutes/30*1000/600000);
      }
    }
  }
</script>